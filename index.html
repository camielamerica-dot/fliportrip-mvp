<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FlipOrTrip | Ontdek Valkenburg</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;800&display=swap" rel="stylesheet">
    <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
    
    <style>
        :root { --mint: #00FFC2; --obsidian: #0B0E14; --card-bg: #161B22; --text-muted: #8899A6; }
        body { background: var(--obsidian); color: white; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; overflow: hidden; }
        
        /* Onboarding */
        #onboarding { position: fixed; inset: 0; background: var(--obsidian); z-index: 1000; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
        .logo { width: 140px; margin: 0 auto 40px; display: block; }
        h1 { font-size: 22px; text-align: center; margin-bottom: 30px; }
        .step { display: none; }
        .step.active { display: block; }
        
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .opt-btn { background: var(--card-bg); border: 2px solid transparent; padding: 20px; border-radius: 20px; color: white; cursor: pointer; text-align: center; font-weight: 800; transition: 0.3s; }
        .opt-btn.selected { border-color: var(--mint); background: rgba(0,255,194,0.1); color: var(--mint); }

        /* Swipe Deck */
        #app { display: none; height: 100vh; position: relative; }
        .deck { position: relative; width: 90%; height: 70vh; margin: 20px auto; perspective: 1000px; }
        .card { position: absolute; width: 100%; height: 100%; border-radius: 30px; overflow: hidden; background: var(--card-bg); box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform-origin: 50% 100%; }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { position: absolute; bottom: 0; left: 0; right: 0; padding: 30px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); }
        .card-title { font-size: 28px; font-weight: 800; margin: 0; }
        .card-tag { color: var(--mint); font-size: 12px; text-transform: uppercase; font-weight: 800; }

        /* Buttons */
        .controls { display: flex; justify-content: center; gap: 20px; padding: 20px; }
        .round-btn { width: 70px; height: 70px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; transition: 0.2s; }
        .dislike { background: #161B22; color: #FF4B4B; border: 2px solid #FF4B4B; }
        .like { background: var(--mint); color: var(--obsidian); }

        .btn-main { background: var(--mint); color: var(--obsidian); border: none; padding: 20px; border-radius: 50px; font-weight: 800; width: 100%; cursor: pointer; text-transform: uppercase; }
    </style>
</head>
<body>

    <div id="onboarding">
        <img src="https://wijzijnvalkenburg.nl/wp-content/uploads/2026/02/fliportrip_logo.png" class="logo">
        
        <div id="step1" class="step active">
            <h1>Wat is je leeftijd?</h1>
            <div class="option-grid">
                <div class="opt-btn" onclick="selectOpt('age', '18-24', this)">18-24</div>
                <div class="opt-btn" onclick="selectOpt('age', '25-34', this)">25-34</div>
                <div class="opt-btn" onclick="selectOpt('age', '35-50', this)">35-50</div>
                <div class="opt-btn" onclick="selectOpt('age', '50+', this)">50+</div>
            </div>
            <button class="btn-main" onclick="nextStep(2)">Volgende</button>
        </div>

        <div id="step2" class="step">
            <h1>Met wie ben je?</h1>
            <div class="option-grid">
                <div class="opt-btn" onclick="selectOpt('tripType', 'Partner', this)">Partner</div>
                <div class="opt-btn" onclick="selectOpt('tripType', 'Vrienden', this)">Vrienden</div>
                <div class="opt-btn" onclick="selectOpt('tripType', 'Familie', this)">Familie</div>
                <div class="opt-btn" onclick="selectOpt('tripType', 'Solo', this)">Solo</div>
            </div>
            <button class="btn-main" onclick="startApp()">Start Flipping</button>
        </div>
    </div>

    <div id="app">
        <div class="deck" id="deck"></div>
        <div class="controls">
            <button class="round-btn dislike" onclick="swipeLeft()">✕</button>
            <button class="round-btn like" onclick="swipeRight()">♥</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAx_XDqOW9hth7dwSFBZYJnk_dTa2lnvQ0",
            authDomain: "fliportrip-valkenburg.firebaseapp.com",
            projectId: "fliportrip-valkenburg",
            storageBucket: "fliportrip-valkenburg.firebasestorage.app"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let activities = [];
        let currentProfile = { age: '', tripType: '', gender: 'Vrouw' }; // Gender default voor demo

        // ONBOARDING LOGICA
        window.selectOpt = (key, val, el) => {
            document.querySelectorAll(`.step.active .opt-btn`).forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            currentProfile[key] = val;
        };

        window.nextStep = (n) => {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
        };

        window.startApp = async () => {
            document.getElementById('onboarding').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            await loadActivities();
        };

        // DATA LADEN
        async function loadActivities() {
            const snap = await getDocs(collection(db, "activities"));
            activities = snap.docs.map(d => d.data());
            renderDeck();
        }

        function renderDeck() {
            const container = document.getElementById('deck');
            container.innerHTML = '';
            activities.forEach((act, i) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.zIndex = activities.length - i;
                card.innerHTML = `
                    <img src="${act.image || 'https://via.placeholder.com/400x600'}">
                    <div class="card-info">
                        <span class="card-tag">${act.categories ? act.categories[0] : 'Valkenburg'}</span>
                        <h2 class="card-title">${act.title}</h2>
                        <p style="color:var(--mint); font-weight:800; margin:5px 0 0;">${act.price || 'Gratis'}</p>
                    </div>
                `;
                container.appendChild(card);
                if(i === 0) setupHammer(card, act.title);
            });
        }

        // SWIPE & ANALYTICS LOGICA
        function setupHammer(el, title) {
            const mc = new Hammer(el);
            mc.on("pan", (e) => {
                el.style.transition = 'none';
                el.style.transform = `translate(${e.deltaX}px, ${e.deltaY}px) rotate(${e.deltaX/20}deg)`;
            });

            mc.on("panend", (e) => {
                el.style.transition = '0.5s';
                if (e.deltaX > 150) {
                    handleSwipe(title, 'like', 'translateX(200%) rotate(30deg)');
                } else if (e.deltaX < -150) {
                    handleSwipe(title, 'dislike', 'translateX(-200%) rotate(-30deg)');
                } else {
                    el.style.transform = 'translate(0,0) rotate(0)';
                }
            });
        }

        async function handleSwipe(title, action, transform) {
            const cards = document.getElementsByClassName('card');
            if(cards[0]) {
                cards[0].style.transform = transform;
                setTimeout(() => cards[0].remove(), 500);
            }

            // DIT VOEDT HET DASHBOARD:
            try {
                await addDoc(collection(db, "global_analytics"), {
                    activityTitle: title,
                    action: action, // 'like' of 'dislike'
                    timestamp: new Date(),
                    userAge: currentProfile.age,
                    userGender: currentProfile.gender,
                    tripType: currentProfile.tripType
                });
            } catch (e) { console.error(e); }

            activities.shift();
            if(activities.length > 0) {
                setTimeout(() => {
                    const nextCard = document.getElementsByClassName('card')[0];
                    if(nextCard) setupHammer(nextCard, activities[0].title);
                }, 200);
            }
        }

        window.swipeRight = () => handleSwipe(activities[0].title, 'like', 'translateX(200%) rotate(30deg)');
        window.swipeLeft = () => handleSwipe(activities[0].title, 'dislike', 'translateX(-200%) rotate(-30deg)');

    </script>
</body>
</html>
